<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>index</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-8a79a254b8e706d3c925cde0a310d4f0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<p>Ceci est la première édition du manuel de formation MOSAIKS. Le manuel sert de référence pour comprendre MOSAIKS, ses capacités et les bonnes pratiques pour l’utiliser. Vous apprendrez ce qu’est MOSAIKS, ce qu’il permet de faire et comment l’utiliser efficacement dans une variété d’applications.</p>
<p>Les compétences et les connaissances que vous acquérez de ce manuel vous permettront de tirer parti des images satellites et de l’apprentissage automatique pour relever des défis socio-économiques et environnementaux complexes. Ce manuel peut être suivi tout seul de manière autodidacte ou utilisé en conjonction avec un cours de formation.</p>
<p>De nombreux concepts et exemples sont largement applicables au monde de la télédétection et de l’apprentissage automatique, donc même si vous n’utilisez pas MOSAIKS, le contenu peut vous être utile.</p>
<section id="quest-ce-que-mosaiks" class="level2">
<h2 class="anchored" data-anchor-id="quest-ce-que-mosaiks">Qu’est-ce que MOSAIKS?</h2>
<p>MOSAIKS signifie <strong><ins>M</ins>ulti-task <ins>O</ins>bservation using <ins>SA</ins>tellite <ins>I</ins>magery &amp; <ins>K</ins>itchen <ins>S</ins>inks</strong>, soit littéralement en français <em>Observation multitâche à l’aide de l’imagerie satellitaire et des éviers de cuisine</em>. Il s’agit d’un cadre conçu pour simplifier l’utilisation de l’imagerie satellite et de l’apprentissage automatique pour prédire les résultats socio-économiques et environnementaux dans différents contextes géographiques et périodes. MOSAIKS se base sur des filtres de convolutions aléatoires (développées dans Rahimi et RECHT (2008)) appliquées à l’imagerie satellite, qui extrait des features agnostiques des tâches et permettent aux chercheurs et aux praticiens de prédire facilement une diversité de résultats à partir d’images brutes. <img src="images/mosaiks-in-landsat.png" id="fig-mosaiks-in-landsat" class="img-fluid" alt="MOSAIKS spelled out with imagery from the Landsat Satellite Constellation data catalog. Made with: Your Name in Landsat"></p>
</section>
<section id="à-qui-sadresse-ce-livre" class="level2">
<h2 class="anchored" data-anchor-id="à-qui-sadresse-ce-livre">À qui s’adresse ce livre?</h2>
<p>Ce programme complet de deux semaines est conçu pour les universitaires, les professionnels et les praticiens intéressés à tirer parti des MOSAIKS pour mieux comprendre les défis socio-économiques et environnementaux. Le cours est particulièrement précieux pour ceux qui travaillent:</p>
<ul>
<li>Analyse d’images satellitaires et télédétection</li>
<li>Applications d’apprentissage automatique avec des données géospatiales</li>
<li>Surveillance et évaluation de l’agriculture et de l’environnement</li>
<li>Recherche et développement et élaboration des politiques</li>
</ul>
</section>
<section id="que-vais-je-apprendre" class="level2">
<h2 class="anchored" data-anchor-id="que-vais-je-apprendre">Que vais-je apprendre?</h2>
<p>Tout au long de ce cours, vous apprendrez des applications pratiques grâce à une combinaison de:</p>
<ul>
<li>Fondements théoriques et compréhension conceptuelle</li>
<li>Exercices pratiques avec des données réelles</li>
<li>Meilleures pratiques de mise en œuvre</li>
<li>Stratégies d’analyse et d’interprétation des résultats</li>
</ul>
<p>Le programme d’études couvre le flux de travail complet des MOSAIKS, notamment:</p>
<ul>
<li>Accéder et traiter des images satellites</li>
<li>Comprendre l’extraction des features MOSAIKS</li>
<li>Travailler avec l’API MOSAIKS</li>
<li>Implémenter des modèles d’apprentissage automatique</li>
<li>Quantifier et communiquer l’incertitude</li>
<li>Appliquer des modèles à divers contextes</li>
<li>Travailler avec les données d’enquête</li>
</ul>
<p>Que vous soyez nouveau dans MOSAIKS ou que vous cherchiez à approfondir votre expertise, ce cours fournit les outils et les connaissances nécessaires pour utiliser efficacement ce framework.</p>
</section>
<section id="structure-de-cours" class="level2">
<h2 class="anchored" data-anchor-id="structure-de-cours">Structure de cours</h2>
<p>Ce cours est conçu comme un programme intensif de deux semaines qui combine des conférences, des démonstrations et des séances pratiques.Chaque jour est structuré comme suit:</p>
<div id="tbl-course-outline" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-course-outline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Divisions de temps quotidiennes montrant 2 séances du matin, 2 séances de l’après-midi et un dernier créneau horaire attribué pour développer le cours.
</figcaption>
<div aria-describedby="tbl-course-outline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<thead>
<tr class="header">
<th><strong>Horaire</strong></th>
<th style="text-align: left;"><strong>Activité</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>9h00 - 10h30</td>
<td style="text-align: left;">Session du matin 1</td>
</tr>
<tr class="even">
<td>10h30 - 11h00</td>
<td style="text-align: left;">Pause</td>
</tr>
<tr class="odd">
<td>11h00 - 12h30</td>
<td style="text-align: left;">Session du matin 2</td>
</tr>
<tr class="even">
<td>12h30 - 13h30</td>
<td style="text-align: left;">Déjeuner</td>
</tr>
<tr class="odd">
<td>13h30 - 15h00</td>
<td style="text-align: left;">Session de l’après-midi 1</td>
</tr>
<tr class="even">
<td>15h00 - 15h30</td>
<td style="text-align: left;">Pause</td>
</tr>
<tr class="odd">
<td>15h30 - 16h30</td>
<td style="text-align: left;">Session de l’après-midi 2</td>
</tr>
<tr class="even">
<td>16h30 - 17h00</td>
<td style="text-align: left;">Feedback and Development</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Chaque jour se termine par une séance de questions-réponses et une session de rétroaction de 16h30 à 17h00, offrant des opportunités de clarifier les concepts et de partager des idées. Il est prévu que ce premier cours stimulera de nombreuses nouvelles idées et concepts qui devraient être inclus dans les futures formations. N’oubliez pas de prendre des notes tout au long de chaque journée avec un accent particulier dans les domaines qui, selon vous, pourraient être mieux expliqués ou qui ont besoin de sujets supplémentaires couverts. Il peut s’agir de domaines avec lesquels vous avez des difficultés ou que vous anticipez pourraient être difficiles pour les autres.</p>
<p>Bien que la version en personne de ce cours ait été conçue avec le calendrier décrit ci-dessus, les autres utilisateurs peuvent facilement naviguer dans le contenu du cours comme il le souhaite. Notons que le contenu du chapitre est conçu pour l’apprentissage séquentiel.</p>
</section>
<section id="horaire-de-cours" class="level2">
<h2 class="anchored" data-anchor-id="horaire-de-cours">Horaire de cours</h2>
<section id="semaine-1" class="level3">
<h3 class="anchored" data-anchor-id="semaine-1">Semaine 1</h3>
<ul>
<li><strong>Jour 1</strong>: Framework MOSAIKS, fonctionnalités d’accès, workflow de base</li>
<li><strong>Jour 2</strong>: Comprendre les données de vérité au sol, le nettoyage des données, la résolution spatiale</li>
<li><strong>Jour 3</strong>: Prédiction de rendement agricole, téléchargement des fonctionnalités via API</li>
<li><strong>Jour 4</strong>: Types d’images satellites, considérations de traitement, contrôle de la qualité</li>
<li><strong>Jour 5</strong>: Calcul des fonctionnalités, théorie derrière les RCF, implémentation pratique</li>
</ul>
</section>
<section id="semaine-2" class="level3">
<h3 class="anchored" data-anchor-id="semaine-2">Semaine 2</h3>
<ul>
<li><strong>Jour 1</strong>: Sélection du modèle, réglage de l’hyperparamètre, validation croisée</li>
<li><strong>Jour 2</strong>: Analyse des erreurs, intervalles de confiance, rapport incertitude</li>
<li><strong>Jour 3</strong>: Principes de conception de l’enquête, méthodes de géolocalisation, stratégies d’échantillonnage</li>
<li><strong>Jour 4</strong>: Sujets avancés, applications émergentes, développement futur</li>
</ul>
</section>
</section>
<section id="attentes-de-la-formation" class="level2">
<h2 class="anchored" data-anchor-id="attentes-de-la-formation">Attentes de la formation</h2>
<section id="ce-que-vous-apprendrez" class="level3">
<h3 class="anchored" data-anchor-id="ce-que-vous-apprendrez">Ce que vous apprendrez</h3>
<ul>
<li>Compréhension du framework et des capacités de MOSAIKS</li>
<li>Compétences pratiques dans le traitement des images satellites<br>
</li>
<li>Expérience avec les applications d’apprentissage automatique</li>
<li>Pratique avec des ensembles de données du monde réel</li>
<li>Connaissance de l’intégration des données d’enquête/sondage</li>
<li>Meilleures pratiques pour la mise en œuvre du modèle</li>
</ul>
</section>
<section id="prérequis" class="level3">
<h3 class="anchored" data-anchor-id="prérequis">Prérequis</h3>
<p>Il n’y a pas de conditions préalables explicites. Toutefois pour les travaux pratiques une connaissance des outils suivants est nécessaire</p>
<ul>
<li><a href="https://www.python.org/" data-target="_blank"><code>Python</code></a> Langage de programmation</li>
<li><a href="https://jupyter.org/"><code>Jupyter Notebook</code></a> Outil permettant d’exécuter le code Python de manière interactive.</li>
</ul>
<p>Le cours couvre également des sujets avancés tels que l’apprentissage automatique et les données géospatiales dont une connaissance préalable facilite la compréhension du contenu.</p>
</section>
<section id="attentes-des-participants" class="level3">
<h3 class="anchored" data-anchor-id="attentes-des-participants">Attentes des participants</h3>
<ul>
<li>Participer activement aux discussions et aux sessions pratiques</li>
<li>Finir les devoirs attribués (en particulier la mission de la semaine 1 vendredi)<br>
</li>
<li>S’engager dans les séances de questions-réponses</li>
<li>Contribuer aux séances de rétroaction pour l’amélioration des cours</li>
</ul>
</section>
<section id="exigences-informatiques" class="level3">
<h3 class="anchored" data-anchor-id="exigences-informatiques">Exigences informatiques</h3>
<p>Le cours comprend des séances informatiques pratiques.Vous aurez besoin:</p>
<ul>
<li>Un ordinateur avec accès à Internet</li>
<li>Un compte Google</li>
<li>Accès à Google Colab</li>
<li>Accès aux données nécessaires (détails à fournir)</li>
</ul>
</section>
<section id="devoirs-maison-et-présentations" class="level3">
<h3 class="anchored" data-anchor-id="devoirs-maison-et-présentations">Devoirs maison et présentations</h3>
<p>Il y aura un devoir-maison à la fin de la semaine 1, que les participants présenteront le lundi de la semaine 2. Ce travail est conçu pour renforcer l’apprentissage et offrir une expérience pratique avec les outils MOSAIKS.</p>
</section>
</section>
<section id="structure-et-contenu-du-livre" class="level2">
<h2 class="anchored" data-anchor-id="structure-et-contenu-du-livre">Structure et contenu du livre</h2>
<p>Ce manuel est organisé en six parties principales, chacune se concentrant sur un aspect critique des MOSAIKS. Nous commençons par des concepts fondamentaux et progressons progressivement vers des sujets plus avancés dans la modélisation et la quantification de l’incertitude.</p>
<div id="tbl-part-outline" class="striped hover quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-part-outline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Présentation du contenu du manuel de formation des MOSAIKS
</figcaption>
<div aria-describedby="tbl-part-outline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table-hover caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 68%">
</colgroup>
<thead>
<tr class="header">
<th>Partie</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Introduction</td>
<td style="text-align: left;">Configuration de l’informatique, Présentation des MOSAIKS, accès API, démonstration initiale</td>
</tr>
<tr class="even">
<td>Données d’étiquette</td>
<td style="text-align: left;">Comprendre les étiquettes appropriées, l’intégration d’enquête, la préparation des données</td>
</tr>
<tr class="odd">
<td>Imagerie satellite</td>
<td style="text-align: left;">Sélection de l’imagerie appropriée, des considérations de traitement</td>
</tr>
<tr class="even">
<td>Caractéristiques</td>
<td style="text-align: left;">Caractéristiques convolutionnelles aléatoires, accès API, calcul des fonctionnalités</td>
</tr>
<tr class="odd">
<td>Modélisation des tâches</td>
<td style="text-align: left;">Sélection du modèle, analyse spatiale, considérations temporelles</td>
</tr>
<tr class="even">
<td>Incertitude du modèle</td>
<td style="text-align: left;">Quantification de l’incertitude, considérations éthiques</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Le contenu est conçu pour être à la fois complet et pratique, chaque partie s’appuyant sur les concepts précédents tout en restant relativement autonome. Cette structure permet aux lecteurs de progresser dans le manuel séquentiellement ou de se concentrer sur des sujets d’intérêt spécifiques. Tout au long de chaque section, nous fournissons des exemples pratiques, des démonstrations de code et des meilleures pratiques tirées des applications du monde réel.</p>
</section>
<section id="remerciements" class="level2">
<h2 class="anchored" data-anchor-id="remerciements">Remerciements</h2>
<p>MOSAIKS a été développé et est soutenu par une grande équipe de chercheurs dans plusieurs organisations partenaires:</p>
<p><strong>Équipe de développement:</strong></p>
<p>Benjamin Recht, Cullen Molitor, Darin Christensen, Esther Rolf, Eugenio Noda, Grace Lewin, Graeme Blair, Hannah Druckenmiller, Hikari Murayama, Ian Bolliger, Jean Tseng, Jessica Katz, Jonathan Proctor, Juliet Cohen, Karena Yan, Luke Sherman, Miyabi Ishihara, Shopnavo Biswas, Simon Greenhill, Salomon Hsiang, Steven Cognac, Tamma Carleton, Taryn Fransen, Trinetta Chong, Vaishaal Shankar</p>
<p><strong>Équipe du manuel de formation Mosaiks:</strong> Cullen Molitor, Tamma Carleton, Esther Rolf, Sean Luna McAdams, Heather Lahr, Gnouyaro Zissler Sougoyou, Farooq Sanni</p>
<p><strong>Organisations partenaires:</strong></p>
<ul>
<li>Center for Effective Global Action (<a href="https://cega.berkeley.edu/">CEGA</a>; UCB)</li>
<li>Environmental Markets Lab (<a href="https://emlab.ucsb.edu/">Emlab</a>; UCSB)</li>
<li>Global Policy Lab (<a href="https://www.globalpolicy.science/">GPL</a>; Université de Stanford)</li>
<li>Project on Resources and Governance (<a href="https://projecttrg.org/">PRG</a>; UCLA)</li>
<li>Master of Environmental Data Science Program (<a href="https://bren.ucsb.edu/masters-programs/master-environmental-data-science">Meds</a>; UCSB)</li>
</ul>
<p><strong>Financement:</strong></p>
<ul>
<li><a href="https://www.mcgovern.org/">La Fondation Patrick J. McGovern</a></li>
<li><a href="https://fundinnovation.dev/">Le ​​Fonds pour l’innovation dans le développement (FID)</a></li>
<li><a href="https://www.usaid.gov/">The United States Agency for International Development (USAID)</a></li>
<li><a href="https://www.undp.org/">Programme des Nations Unies pour le développement (PNUD)</a></li>
</ul>
<p>Nous sommes reconnaissants pour le soutien et les contributions de tous les membres de l’équipe et des organisations partenaires pour faire de MOSAIKS une réalité. Nous espérons continuer à étendre le cadre et ses applications pour relever des défis mondiaux pressants.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dans la première partie de ce livre, nous couvrirons les bases de MOSAIKS, y compris son framework, ses capacités et ses applications pratiques. Cette section se concentre sur l’exploration de la publication originale de MOSAIKS (Rolf et al.&nbsp;2021) et la compréhension des concepts de base derrière le framework.</p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>