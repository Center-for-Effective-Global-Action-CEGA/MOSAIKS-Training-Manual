---
lang: fr
---
# Préparation des étiquettes {#sec-labels-data-prep}

```{r}
#| echo: false
#| results: "asis"
#| 
source("../../_common.R")
status("review_fr")
```

## Aperçu

Dans ce chapitre, nous abordons le processus de préparation des étiquettes pour leur utilisation avec les caractéristiques MOSAIKS. Les étiquettes sont les valeurs observées que nous cherchons à prédire avec notre modèle—comme les rendements agricoles, le couvert forestier ou toute autre variable d’intérêt. Elles peuvent se présenter sous différents formats spatiaux (ex. : points, polygones ou rasters en grille), mais elles doivent inclure une composante spatiale. Cette information spatiale est utilisée pour associer les étiquettes aux caractéristiques MOSAIKS, qui sont également explicitement spatiales.

Bien que MOSAIKS offre de nombreuses étapes optionnelles, deux éléments sont essentiels :

1. Observations terrain (étiquettes)  
2. Caractéristiques satellitaires  

Les deux jeux de données doivent être alignés en résolution spatiale et contenir des informations géographiques appropriées pour être fusionnés.

## Grille MOSAIKS

Avant d’aborder les étiquettes, il est essentiel de comprendre la résolution dans laquelle les caractéristiques MOSAIKS sont fournies. La résolution choisie servira de référence pour le résumé de vos étiquettes.

### Résolution

La résolution standard de MOSAIKS est une grille mondiale à une résolution de 0,01°. Chaque cellule de la grille représente environ 1 km² à l’équateur. La grille est souvent représentée sous forme de points, où chaque point est le centre d’une cellule de grille. Cela signifie que les caractéristiques MOSAIKS standard sont fournies avec des coordonnées de latitude et de longitude correspondant au centre de la cellule de grille.

::: {.callout-note}
Les centroïdes des cellules de la grille MOSAIKS sont arrondis à 0,005 degré et espacés de 0,01 degré (ex. : 10.005, 10.015, 10.025,...).
:::

![Représentation visuelle des grilles standardisées à différentes résolutions (δ), avec la résolution la plus élevée à gauche et les résolutions plus basses vers la droite. Source : [Rolf et al. 2021 Figure 3 c](https://www.nature.com/articles/s41467-021-24638-z/figures/3).](../../images/rolf_et_al_2021-Fig_3-c-grid.svg){#fig-grid}

### Avantages de la grille MOSAIKS

La grille MOSAIKS présente plusieurs avantages. Le principal avantage est qu’elle évite le chevauchement des étiquettes. Souvent, les données d’étiquettes sont fournies avec des coordonnées irrégulièrement espacées. En les alignant sur une grille et en les résumant au sein des cellules, on évite le débordement d’une étiquette sur une autre. Cela est particulièrement important lorsque l’on travaille avec des données ayant un fort degré d’autocorrélation spatiale.

::: {.callout-note}
L'API MOSAIKS est conçue pour prédire des résultats à des échelles de 1 km² ou plus. Des solutions personnalisées sont possibles pour des applications à plus haute résolution (voir @sec-features-computing).  
:::

### Inconvénients de la grille MOSAIKS

La grille MOSAIKS est définie en degrés, ce qui signifie que la superficie d’une cellule varie en fonction de la latitude. Près de l’équateur, chaque cellule mesure environ 1 km², tandis qu’aux latitudes élevées, la superficie diminue à mesure que la distance entre les méridiens (lignes de longitude) converge.

![Superficie d'une cellule de grille selon la latitude.](../../images/global_1_degree_grid_wgs84_area.png){#fig-grid-area}

### Choisir votre résolution

Nous savons d’après @sec-intro-api que l’API MOSAIKS propose des caractéristiques à des résolutions de 0.01°, 0.1°, 1°, ADM2, ADM1 et ADM0. Dans tous les cas, les caractéristiques sont calculées à 0.01° et ensuite agrégées à la résolution souhaitée. Si vous prévoyez d’utiliser l’API pour télécharger des caractéristiques, vous devez vous assurer que vos étiquettes sont à la même résolution que celles des caractéristiques que vous téléchargez.

## Observations terrain

### Résolution

La préparation des données d’étiquettes pour MOSAIKS dépend de l’emplacement, de l’étendue, du temps et de la résolution. Lorsque les observations ont une résolution plus fine que 1 km², il faut les sélectionner ou les agréger pour correspondre aux caractéristiques utilisées. MOSAIKS peut incorporer des étiquettes sous forme de données raster, points, polygones ou vecteurs.

![Exemples de formats de données d’étiquettes intégrables au pipeline MOSAIKS.](../../images/rolf_et_al_2021-Fig_S4.png){#fig-label-agg}

### Données administratives

Dans certains cas, les étiquettes sont disponibles pour des régions administratives (états, districts, etc.) et ne contiennent que des noms de lieux sans information géographique explicite. Une solution est d’utiliser une base de données de frontières administratives, comme la [base Global Administrative Areas (GADM)](https://gadm.org/), qui fournit ces limites gratuitement.

![Données de l’indice de développement humain (IDH) au niveau administratif 1 (ADM1).](../../images/smits_and_permanyer_2019_HDI.png){#fig-hdi}

### Défis liés aux données administratives

Les données administratives posent deux défis principaux :

1. **Correspondance des noms :** Les noms dans votre jeu de données peuvent ne pas correspondre exactement à ceux de la base GADM ou de l’API MOSAIKS. Trouver une correspondance exhaustive peut être complexe.
2. **Changements des limites :** Les limites administratives évoluent avec le temps. Il faut s’assurer que les données correspondent aux limites des caractéristiques utilisées.

### Taille de l’échantillon

Augmenter la taille de l’échantillon (*N*) améliore souvent la performance du modèle. MOSAIKS fonctionne bien sur une large gamme de *N*, mais un minimum de **300 observations** est recommandé.

![Performance du modèle en fonction de *N*.](../../images/rolf_et_al_2021-Fig_3-b.svg){#fig-sample-size}

## Fusion des données

### Associer les étiquettes aux caractéristiques MOSAIKS

Pour fusionner les étiquettes avec les caractéristiques MOSAIKS, il faut aligner la localisation géographique des deux jeux de données. Les fichiers de caractéristiques MOSAIKS contiennent des colonnes pour la longitude, la latitude et les caractéristiques. Les étiquettes doivent inclure ces mêmes colonnes.

### Exemple de structure de données fusionnées

Un exemple simple : les étiquettes de rendement des cultures au niveau des districts pourraient ressembler à :

| Observation | District  | Année | Rendement des cultures |
|-------------|-----------|-------|------------------------|
| 1           | Chibombo  | 2019  | 1.520                  |
| 2           | Kabwe     | 2019  | 1.878                  |
| ...         | ...       | ...   | ...                    |
| *N*         | Kitwe     | 2019  | 2.383                  |

: Données fictives sur le rendement des cultures pour les districts de Zambie. {#tbl-crop-yield}

Les caractéristiques MOSAIKS à la même résolution pourraient ressembler à :

| Observation | District  | Année | Caractéristique 1 | Caractéristique 2 | ... | Caractéristique *K* |
|-------------|-----------|-------|-------------------|-------------------|-----|---------------------|
| 1           | Chibombo  | 2019  | 4.2               | 11.6              | ... | 12.7                |
| 2           | Kabwe     | 2019  | 2.9               | 5.3               | ... | 11.2                |
| ...         | ...       | ...   | ...               | ...               | ... | ...                 |
| *N*         | Kitwe     | 2019  | 10.6              | 1.1               | ... | 2.2                 |

: Données fictives des caractéristiques MOSAIKS pour les mêmes districts. {#tbl-features}

Après une jointure spatiale, vous obtenez un jeu de données fusionné :

| Observation | District  | Année | Rendement des cultures | Caractéristique 1 | Caractéristique 2 | ... | Caractéristique *K* |
|-------------|-----------|-------|------------------------|-------------------|-------------------|-----|---------------------|
| 1           | Chibombo  | 2019  | 1.520                  | 4.2               | 11.6              | ... | 12.7                |
| 2           | Kabwe     | 2019  | 1.878                  | 2.9               | 5.3               | ... | 11.2                |
| ...         | ...       | ...   | ...                    | ...               | ...               | ... | ...                 |
| *N*         | Kitwe     | 2019  | 2.383                  | 10.6              | 1.1               | ... | 2.2                 |


: Exemple de données fusionnées avec étiquettes et features. {#tbl-joined-data}

Dans l'exemple ci-dessus, notre localisation géographique est le district et notre étiquette est le rendement des cultures (mt/ha). Nous avons ensuite *K* colonnes contenant les caractéristiques et *N* observations.

## Considérations sur le nettoyage des données

### Systèmes de référence des coordonnées (SRC)

Le système de référence des coordonnées par défaut utilisé par MOSAIKS est le World Geodetic System 84 (WGS 84). Le code standardisé qui définit le WGS 84 est ["EPSG:4326"](https://epsg.io/4326). EPSG signifie [European Petroleum Survey Group](https://en.wikipedia.org/wiki/EPSG_Geodetic_Parameter_Dataset), qui maintient une base de données des systèmes de coordonnées et des projections. Le système de coordonnées WGS 84 est le système le plus couramment utilisé pour les données GPS.

![[Neuf projections cartographiques à petite échelle.](https://www.researchgate.net/publication/273517879_User_preferences_for_world_map_projections)](https://www.researchgate.net/profile/Bojan-Savric/publication/273517879/figure/fig1/AS:347863067447297@1459948426262/The-nine-small-scale-map-projections-used-in-the-paired-comparison-test-arranged-by.png){#fig-map-projections}

Si vos données ne sont pas en WGS 84, vous devrez les reprojeter dans ce système de référence avant de les joindre aux caractéristiques MOSAIKS.

### Qualité des étiquettes

Vérifiez que les valeurs des étiquettes se situent dans les plages attendues, traitez les éventuelles valeurs aberrantes ou les données manquantes, et assurez-vous que les unités sont cohérentes et que les champs numériques sont correctement formatés. Ce livre n'entre pas dans les détails du nettoyage des données désordonnées. Ce sujet est traité de manière exhaustive dans le livre [R for Data Science](https://r4ds.had.co.nz/).

### Alignement temporel

Si vous disposez d'étiquettes de séries temporelles, vous devrez calculer des caractéristiques personnalisées pour chaque période. Voir @sec-features-computing pour plus d'informations sur la manière de procéder et @sec-model-temporal pour des conseils sur la modélisation des données de séries temporelles avec les caractéristiques MOSAIKS.

### Formats des données

MOSAIKS fonctionne avec plusieurs formats spatiaux :

| Type de données | Formats courants | Exemple |
|----------------|-----------------|---------|
| Points        | CSV, GeoJSON     | Lieux d’intérêt |
| Lignes        | GeoJSON, Shapefile | Routes, rivières |
| Polygones     | GeoJSON, Shapefile | Zones géographiques |
| Raster        | GeoTIFF, NetCDF  | Forêt, élévation |
| Administratif | CSV              | Districts, états |

: Formats spatiaux pris en charge par MOSAIKS. {#tbl-spatial-data-formats}

::: {.callout-tip}
L’utilisation de formats optimisés comme Parquet ou Feather peut améliorer la rapidité du traitement.
:::

## Résumé

Les points clés pour préparer les étiquettes pour MOSAIKS :

- [ ] **Alignement géographique et temporel**
- [ ] **Agrégation à ≥ 1 km²**
- [ ] **Échantillon de taille suffisante (N≥300)**
- [ ] **Données propres et formatées**

::: {.callout-note}
# À venir

Le prochain chapitre abordera le nettoyage et l’agrégation des étiquettes pour MOSAIKS.
:::
